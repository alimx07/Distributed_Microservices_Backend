server:
  host: "0.0.0.0"
  port: "8080"
  public_key_addr: "localhost:9090"  # User service public key endpoint (overridden by PUBLIC_KEY_ADDR env var in Docker)


rate_limiting:
  rules_config: "rate_rules.json"
  script_path: "redis_script.lua"
  addr: "localhost:6379"
  pool_size: 10

redis_config:
  redis_addr: "localhost:7000"
  redis_check_script: "check_token.lua"
  redis_add_script: "add_token.lua"
  redis_pool_size: 5

# Service instances for load balancing
services:
  user_service:
    instances:
      - "user-service1:50051"
      - "user-service2:50051"
      - "user-service3:50051"
    health_check_interval: 5s
    protoset_path: "_proto/user.protoset"
  
  post_service:
    instances:
      - "post_service:50061"
    health_check_interval: 5s
    protoset_path: "_proto/post.protoset"
  
  follow_service:
    instances:
      - "follow_service:50071"
      - "follow_service:50072"
    health_check_interval: 5s
    protoset_path: "_proto/follow.protoset"
  
  feed_service:
    instances:
      - "feed_service:50081"
    health_check_interval: 5s
    protoset_path: "_proto/feed.protoset"

# HTTP to gRPC routing configuration
routes:
  # User Service Routes
  - path: "/api/v1/register"
    method: "POST"
    service: "user_service"
    grpc_service: "UserService"
    grpc_method: "Register"
    require_auth: false
    rate_limit_enabled: true
    
  - path: "/api/v1/login"
    method: "POST"
    service: "user_service"
    grpc_service: "UserService"
    grpc_method: "Login"
    require_auth: false
    rate_limit_enabled: true
    
  - path: "/api/v1/logout"
    method: "POST"
    service: "user_service"
    grpc_service: "UserService"
    grpc_method: "Logout"
    require_auth: true
    rate_limit_enabled: true
    
  - path: "/api/v1/refresh"
    method: "POST"
    service: "user_service"
    grpc_service: "UserService"
    grpc_method: "Refresh"
    require_auth: false
    rate_limit_enabled: true
    
  - path: "/api/v1/users"
    method: "GET"
    service: "user_service"
    grpc_service: "UserService"
    grpc_method: "GetUsersData"
    require_auth: true
    rate_limit_enabled: true
  
  # Post Service Routes
  - path: "/api/v1/posts/post"
    method: "POST"
    service: "post_service"
    grpc_service: "PostSerive"
    grpc_method: "CreatePost"
    require_auth: true
    rate_limit_enabled: true
    
  - path: "/api/v1/posts"
    method: "GET"
    service: "post_service"
    grpc_service: "PostSerive"
    grpc_method: "GetPosts"
    require_auth: true
    rate_limit_enabled: true
    
  - path: "/api/v1/posts/{PostId}"
    method: "DELETE"
    service: "post_service"
    grpc_service: "PostSerive"
    grpc_method: "DeletePost"
    require_auth: true
    rate_limit_enabled: true
    
  - path: "/api/v1/comments"
    method: "POST"
    service: "post_service"
    grpc_service: "PostSerive"
    grpc_method: "CreateComment"
    require_auth: true
    rate_limit_enabled: true
    
  - path: "/api/v1/comments/{CommentId}"
    method: "DELETE"
    service: "post_service"
    grpc_service: "PostSerive"
    grpc_method: "DeleteComment"
    require_auth: true
    rate_limit_enabled: true
    
  - path: "/api/v1/likes/{PostId}"
    method: "POST"
    service: "post_service"
    grpc_service: "PostSerive"
    grpc_method: "CreateLike"
    require_auth: true
    rate_limit_enabled: true
    
  - path: "/api/v1/likes/{PostId}"
    method: "DELETE"
    service: "post_service"
    grpc_service: "PostSerive"
    grpc_method: "DeleteLike"
    require_auth: true
    rate_limit_enabled: true
  
  # Follow Service Routes
  - path: "/api/v1/followers/{UserId}"
    method: "GET"
    service: "follow_service"
    grpc_service: "FollowService"
    grpc_method: "GetFollowers"
    require_auth: true
    rate_limit_enabled: true
    
  - path: "/api/v1/following/{UserId}"
    method: "GET"
    service: "follow_service"
    grpc_service: "FollowService"
    grpc_method: "GetCeleb"
    require_auth: true
    rate_limit_enabled: true
    
  # Feed Service Routes
  - path: "/api/v1/feed"
    method: "GET"
    service: "feed_service"
    grpc_service: "FeedService"
    grpc_method: "GetFeed"
    require_auth: true
    rate_limit_enabled: true
